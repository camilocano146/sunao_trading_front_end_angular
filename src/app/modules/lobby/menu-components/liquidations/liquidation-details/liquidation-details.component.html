<!--<div *ngIf="preload" class="w-100 text-center">-->
<!--  <img src="./assets//gifs//loading.gif" alt="">-->
<!--</div>-->

<div class="div-back-to-liquidation" (click)="goToLiquidations()">
  <img class="ms-3" src="./assets/icons/arrow_left_yellow_24dp.svg" alt="">
  <h6 class="color-blue py-3 mb-0">
    Volver a mis liquidaciones
  </h6>
</div>

<div class="container">
  <div class="div-info container pb-3">
    <div class="row">
      <h4 class="col-12 col-lg-7 mt-1 color-blue m-0 flex-box-vertical-center">
        Detalle de liquidación
      </h4>
      <div class="div-info-buttons col-12 col-lg-5 row justify-content-end m-0">
        <button mat-raised-button class="btn-very-soft-blue col-5 me-4" (click)="exportLiquidation()">
          <h6 class="m-0">
            <img src="./assets/icons/cheque.svg" alt="" width="25" class="mr-5">
            <span style="margin-left: 1em">
              Exportar
            </span>
          </h6>
        </button>
        <button mat-raised-button class="btn-very-soft-blue col-5" (click)="sendLiquidation()">
          <h6 class="m-0">
            <img src="./assets/icons/cheque.svg" alt="" width="25" class="mr-5">
            <span style="margin-left: 1em">
              Enviar
            </span>
          </h6>
        </button>
      </div>
    </div>

    <div *ngIf="preload">
      <mat-spinner class="m-auto" diameter="80"></mat-spinner>
    </div>

    <div id="div-info-container" *ngIf="!preload">
      <div class="row div-header-info">
        <div class="row col-lg-3 col-sm-6 col-12">
          <div class="col-2" [ngStyle]="{'mask': 'url(' + './assets/import/menu/location.svg' + ') no-repeat center', '-webkit-mask': 'url(' + './assets/import/menu/location.svg' + ') no-repeat center'}"></div>
          <span class="col-10">
            <h6>
              Origen: {{liquidation?.port_origin?.location?.name | titlecase}} ({{liquidation?.port_origin?.name | titlecase}})
            </h6>
          </span>
        </div>

        <div class="row col-lg-3 col-sm-6 col-12">
          <div class="col-2" [ngStyle]="{'mask': 'url(' + './assets/import/menu/location.svg' + ') no-repeat center', '-webkit-mask': 'url(' + './assets/import/menu/location.svg' + ') no-repeat center'}"></div>
          <span class="col-10">
            <h6>
              Destino: {{liquidation?.port_destination?.location?.name | titlecase}} ({{liquidation?.port_destination?.name | titlecase}})
            </h6>
          </span>
        </div>

        <div class="row col-lg-3 col-sm-6 col-12">
          <div class="col-2" [ngStyle]="{'mask': 'url(' + './assets/icons-menu/caja_24dp_white.svg' + ') no-repeat center', '-webkit-mask': 'url(' + './assets/icons-menu/caja_24dp_white.svg' + ') no-repeat center'}"></div>
          <h6 class="col-10">
            Producto: {{liquidation?.product?.name | titlecase}}
          </h6>
        </div>

        <div class="row col-lg-3 col-sm-6 col-12">
          <div class="col-2" [ngStyle]="{'mask': 'url(' + './assets/import/menu/clipboard.svg' + ') no-repeat center', '-webkit-mask': 'url(' + './assets/import/menu/clipboard.svg' + ') no-repeat center'}"></div>
          <span class="col-10">
            <h6 class="number-field-text">
              Partida arancelaria: {{liquidation?.product?.code}}
            </h6>
          </span>
        </div>

        <div class="row col-lg-3 col-sm-6 col-12">
          <div class="col-2" [ngStyle]="{'mask': 'url(' + './assets/icons/calendar.svg' + ') no-repeat center', '-webkit-mask': 'url(' + './assets/icons/calendar.svg' + ') no-repeat center'}"></div>
          <h6 class="col-10 number-field-text">
            Fecha: {{liquidation?.create_at | date}}
          </h6>
        </div>

        <div class="row col-lg-3 col-sm-6 col-12">
          <div class="col-2" [ngStyle]="{'mask': 'url(' + './assets/import/menu/worldwide-shipping.svg' + ') no-repeat center', '-webkit-mask': 'url(' + './assets/import/menu/worldwide-shipping.svg' + ') no-repeat center'}"></div>
          <h6 class="col-10">
            Contenedor: {{liquidation?.container_type?.name }}
          </h6>
        </div>

        <div class="row col-lg-3 col-sm-6 col-12">
          <div class="col-2" [ngStyle]="{'mask': 'url(' + './assets/import/menu/money.svg' + ') no-repeat center', '-webkit-mask': 'url(' + './assets/import/menu/money.svg' + ') no-repeat center'}"></div>
          <h6 class="col-10">
            Divisa: {{liquidation?.currency?.acronym | uppercase}}
          </h6>
        </div>

        <div class="row col-lg-3 col-sm-6 col-12">
          <div class="col-2" [ngStyle]="{'mask': 'url(' + './assets/import/menu/internet.svg' + ') no-repeat center', '-webkit-mask': 'url(' + './assets/import/menu/internet.svg' + ') no-repeat center'}"></div>
          <h6 class="col-10">
            Incoterm: {{liquidation?.incoterm}}
          </h6>
        </div>

        <div class="row col-lg-3 col-sm-6 col-12" *ngIf="liquidation?.incoterm=='DDP'">
          <div class="col-2" [ngStyle]="{'mask': 'url(' + './assets/import/menu/location.svg' + ') no-repeat center', '-webkit-mask': 'url(' + './assets/import/menu/location.svg' + ') no-repeat center'}"></div>
          <span class="col-10">
            <h6>
              Ciudad destino: {{liquidation?.city_destination?.name | titlecase }}
            </h6>
          </span>
        </div>

        <div class="row col-lg-3 col-sm-6 col-12" *ngIf="liquidation?.incoterm=='DDP'">
          <div class="col-2" [ngStyle]="{'mask': 'url(' + './assets/import/menu/location.svg' + ') no-repeat center', '-webkit-mask': 'url(' + './assets/import/menu/location.svg' + ') no-repeat center'}"></div>
          <span class="col-10">
            <h6>
              Total lead time: {{liquidation?.data?.total_days}} días
            </h6>
          </span>
        </div>

      </div>

      <h6 class="color-blue py-3 mb-0">

        <div class="number-field-text">
          TRM: Semana para levantes del {{liquidation?.currency_usd?.from_date}} al {{liquidation?.currency_usd?.to_date}}. {{liquidation?.currency_usd?.value | currency:' ':'symbol':'1.0'}} COP, Fuente DIAN
        </div>

        <div class="color-blue py-3 mb-0">
          Por favor selecciona los costos que deseas visualizar.
        </div>
      </h6>

      <div style="background-color:#ffbf3b; width: 140px; color: aliceblue; text-align: center;">Seleccionada</div>
      <div style="background-color:#00303c; width: 140px; color: aliceblue; text-align: center;">No seleccionada</div>
      <br>

      <div class="row div-menu-options mb-2">
        <div (click)="clickFilterButtons(0)" class="col-lg-2 col-sm-4 col-6">
          <div class="div-option" [ngClass]="{'div-option-to-hide': !selectedFilterButton(0)}">
            Valor FOB
          </div>
        </div>
        <div (click)="clickFilterButtons(1)" class="col-lg-2 col-sm-4 col-6">
          <div class="div-option" [ngClass]="{'div-option-to-hide': !selectedFilterButton(1)}">
            Flete internacional
          </div>
        </div>
        <div (click)="clickFilterButtons(2)" class="col-lg-2 col-sm-4 col-6" *ngIf="!isIncotermCFR() || isIncotermCIF()">
          <div class="div-option" [ngClass]="{'div-option-to-hide': !selectedFilterButton(2)}">
            Seguro internacional
          </div>
        </div>
        <div (click)="clickFilterButtons(3)" class="col-lg-2 col-sm-4 col-6" *ngIf="isIncotermDDP()">
          <div class="div-option" [ngClass]="{'div-option-to-hide': !selectedFilterButton(3)}">
            Aduana y portuarios
          </div>
        </div>
        <div (click)="clickFilterButtons(4)" class="col-lg-2 col-sm-4 col-6" *ngIf="isIncotermDDP()">
          <div class="div-option" [ngClass]="{'div-option-to-hide': !selectedFilterButton(4)}">
            Arancel
          </div>
        </div>
        <div (click)="clickFilterButtons(5)" class="col-lg-2 col-sm-4 col-6" *ngIf="isIncotermDDP()">
          <div class="div-option" [ngClass]="{'div-option-to-hide': !selectedFilterButton(5)}">
            Flete local
          </div>
        </div>
      </div>

      <mat-accordion class="mat-accordion-yellow">
        <mat-expansion-panel #matExpansionPanel1 *ngIf="selectedFilterButton(0)">
          <mat-expansion-panel-header>

            <div class="col-2 div-table-price me-3">
              <h4>
                {{(liquidation?.fob_cost | currency:' ':'symbol':'1.2')}} USD
              </h4>
            </div>

            <img [ngStyle]="{'transform': 'scale(2) rotate(' + (matExpansionPanel1.expanded ? 180 : 0) + 'deg)'}" src="./assets/icons/arrow_drop_down_yellow_24dp.svg" alt="">

            <mat-panel-title>
              Valor FOB
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="row">
            <h5 class="col-8 ps-5">
              Divisa
            </h5>
            <h5 class="col-4">
              {{liquidation?.currency?.acronym | uppercase}}
            </h5>
          </div>

          <div class="row">
            <h5 class="col-8 ps-5">
              Valor Fob ingresado por el usuario ({{liquidation?.currency?.acronym}})
            </h5>
            <h5 class="col-4">
              {{liquidation?.fob_cost_user | currency:' ':'symbol':'1.2'}}
            </h5>
          </div>

          <div class="row" *ngIf="liquidation?.currency?.acronym=='EUR'">
            <h5 class="col-8 ps-5">
              El valor EUR entre {{liquidation?.currency?.from_date}} y {{liquidation?.currency?.to_date}}:
            </h5>
            <h5 class="col-4">
              {{liquidation?.currency?.value | currency:' ':'symbol':'1.2'}} USD
            </h5>
          </div>

          <div class="row" *ngIf="liquidation?.currency?.acronym=='GBP'">
            <h5 class="col-8 ps-5">
              El valor de la libra esterlina entre {{liquidation?.currency?.from_date}} y {{liquidation?.currency?.to_date}}:
            </h5>
            <h5 class="col-4">
              {{liquidation?.currency?.value | currency:' ':'symbol':'1.2'}} USD
            </h5>
          </div>

        </mat-expansion-panel>

        <mat-expansion-panel #matExpansionPanel2 *ngIf="selectedFilterButton(1)">
          <mat-expansion-panel-header>

            <div class="col-2 div-table-price me-3">
              <h4>
                {{(liquidation?.data?.international_freight_cost | currency:' ':'symbol':'1.2')}} USD
              </h4>
            </div>

            <img [ngStyle]="{'transform': 'scale(2) rotate(' + (matExpansionPanel2.expanded ? 180 : 0) + 'deg)'}" src="./assets/icons/arrow_drop_down_yellow_24dp.svg" alt="">

            <mat-panel-title>
              Flete internacional
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="row">
            <h5 class="col-9 ps-5" style="text-align: justify">
              El producto viaja del puerto {{liquidation?.port_origin?.name | titlecase}} ({{liquidation?.port_origin?.location?.name | titlecase}}) al puerto {{liquidation?.port_destination?.name | titlecase}} ({{liquidation?.port_destination?.location?.name | titlecase}})
              y tiene un costo de = {{(liquidation?.data?.international_freight_cost | currency:' ':'symbol':'1.0')}} USD

            </h5>
            <h5 class="col-9 ps-5" style="text-align: justify">
              Dias Libres: {{liquidation?.data?.free_days}} dias
            </h5>
          </div>

        </mat-expansion-panel>

        <mat-expansion-panel #matExpansionPanel3 *ngIf="(isIncotermCIF() || isIncotermDDP()) && selectedFilterButton(2)">
          <mat-expansion-panel-header>

            <div class="col-2 div-table-price me-3">
              <h4>
                {{(liquidation?.data?.insurance_cost | currency:' ':'symbol':'1.2')}} USD
              </h4>
            </div>

            <img [ngStyle]="{'transform': 'scale(2) rotate(' + (matExpansionPanel3.expanded ? 180 : 0) + 'deg)'}" src="./assets/icons/arrow_drop_down_yellow_24dp.svg" alt="">

            <mat-panel-title>
              Seguro internacional
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="row">
            <h5 class="col-8 ps-5">
              (Valor FOB + Flete Internacional) x 0.4% = Valor seguro internacional
            </h5>
          </div>

          <div class="row">
            <h5 class="col-8 ps-5">
              ({{(+liquidation.fob_cost).toFixed(2)}} + {{liquidation?.data?.international_freight_cost}}) x 0.4% = {{(liquidation?.data?.insurance_cost | currency:' ':'symbol':'1.2')}} USD
            </h5>
          </div>

          <div class="row">
            <h3>Nota: El valor minimo del seguro internacional es igual a 50 USD</h3>

          </div>
        </mat-expansion-panel>

        <mat-expansion-panel #matExpansionPanel4 *ngIf="isIncotermDDP() && selectedFilterButton(3)">
          <mat-expansion-panel-header>

            <div class="col-2 div-table-price me-3">
              <h4>
                {{(liquidation?.data?.port_charge | currency:' ':'symbol':'1.0')}} USD
              </h4>
            </div>

            <img [ngStyle]="{'transform': 'scale(2) rotate(' + (matExpansionPanel4.expanded ? 180 : 0) + 'deg)'}" src="./assets/icons/arrow_drop_down_yellow_24dp.svg" alt="">

            <mat-panel-title>
              Aduana y portuarios
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="row">
            <h5 class="col-10 ps-5">
              <div>
                Portuarios:
              </div>
              <div *ngIf="!listPortCharge || listPortCharge?.length === 0" style="text-indent: 30px">
                No hay valores portuarios.
              </div>
              <ul *ngIf="listPortCharge?.length > 0">
                <li *ngFor="let item of listPortCharge" class="number-field-text">
                  Concepto = {{item.concept}}, valor = {{ ( item.value / liquidation?.currency_usd.value  | currency:' ':'symbol':'1.2')}} USD.
                </li>
              </ul>
            </h5>
          </div>

        </mat-expansion-panel>

        <mat-expansion-panel #matExpansionPanel5 *ngIf="isIncotermDDP() && selectedFilterButton(4)">
          <mat-expansion-panel-header>

            <div class="col-2 div-table-price me-3">
              <h4>
                {{(liquidation?.data?.gravamen_tarif | currency:' ':'symbol':'1.2')}} USD
              </h4>
            </div>

            <img [ngStyle]="{'transform': 'scale(2) rotate(' + (matExpansionPanel5.expanded ? 180 : 0) + 'deg)'}" src="./assets/icons/arrow_drop_down_yellow_24dp.svg" alt="">

            <mat-panel-title>
              Arancel
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="row">
            <h5 class="col-8 ps-5">
<!--              Mostrar todos los Trados y Gravamen-->
              Tratados:
              <div *ngIf="!listInternationalAgreement || listInternationalAgreement?.length === 0" style="text-indent: 30px">
                No hay tratados.
              </div>
              <ul *ngIf="listInternationalAgreement?.length > 0">
                <li *ngFor="let item of listInternationalAgreement">
                  País = {{item.location}}, Título = {{item.title}}, Fecha = {{item.date | date}}, Título = {{item.title}}, Gravamen = {{item.gravamen}}%.
                </li>
              </ul>

              <br>
              <div>
                Gravamen:
              </div>
              <div *ngIf="!listGravament || listGravament?.length === 0" style="text-indent: 30px">
                No hay gramaven.
              </div>
              <ul *ngIf="listGravament?.length > 0">
                <li *ngFor="let item of listGravament">
                  Fecha = {{item.date | date}}, tarifa = {{(item.tarif | currency:'$ ':'symbol':'1.2')}}%.
                </li>
              </ul>
            </h5>
          </div>

        </mat-expansion-panel>

        <mat-expansion-panel #matExpansionPanel6 *ngIf="isIncotermDDP() && selectedFilterButton(5)">
          <mat-expansion-panel-header>

            <div class="col-2 div-table-price me-3">
              <h4>
                {{(liquidation?.data?.national_freight_cost | currency:' ':'symbol':'1.2')}} USD
              </h4>
            </div>

            <img [ngStyle]="{'transform': 'scale(2) rotate(' + (matExpansionPanel6.expanded ? 180 : 0) + 'deg)'}" src="./assets/icons/arrow_drop_down_yellow_24dp.svg" alt="">

            <mat-panel-title>
              Flete local
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="row">
            <h5 class="col-8 ps-5" style="text-align: justify">
              El producto viaja del puerto destino {{liquidation?.port_destination?.name | titlecase}} en {{liquidation?.port_destination?.location?.name | titlecase}} a la ciudad {{liquidation?.city_destination?.name | titlecase}}
              y tiene un costo de {{(liquidation?.data?.national_freight_cost | currency:' ':'symbol':'1.2')}} USD
<!--              quien es el proveedor, de donde a donde y cual es el valor-->
            </h5>

            <h5 class="col-9 ps-5" *ngIf='liquidation?.data?.return_cost==true' style="text-align: justify">
              Incluye costo de retorno: Sí
            </h5>
            <h5 class="col-9 ps-5" *ngIf='liquidation?.data?.return_cost==false' style="text-align: justify">
              Incluye costo de retorno: No
            </h5>

<!--            <h5 class="col-4">-->
<!--              {{1200 | currency}}-->
<!--            </h5>-->
          </div>

        </mat-expansion-panel>
      </mat-accordion>

      <div class="div-total row">
        <h4 class="col-6">
          Total {{getCalculateIcoterm()}}:
        </h4>
        <h4 class="col-6 text-right">
          {{((calculateTotalValue() | currency:' ':'symbol':'1.2') + '')}} USD
        </h4>
      </div>

      <div class="row m-0 div-bottom-info">
        <h6 class="color-blue py-3 mb-0 col-10">
          Valor liquidado solo para efectos de flujo de caja, NO incluido en el costo total de la liquidación, por ser el IVA un valor deducible.
        </h6>

        <mat-checkbox [(ngModel)]="seeIVA" (click)="showIVA()" class="col-2">
          Visualizar IVA
        </mat-checkbox>
      </div>

      <mat-accordion *ngIf="seeIVA" class="mat-accordion-blue">
        <mat-expansion-panel #matExpansionFiles>
          <mat-expansion-panel-header>

            <div class="col-2 div-table-price me-3">
              <h4 *ngIf="liquidation?.data?.iva_tarif">
                {{liquidation?.data?.iva_tarif | currency : ' ' : 'symbol' : '1.2' }} USD
              </h4>
              <h4 *ngIf="!liquidation?.data?.iva_tarif">
                0
              </h4>
            </div>

            <img [ngStyle]="{'transform': 'scale(2) rotate(' + (matExpansionFiles.expanded ? 180 : 0) + 'deg)'}" src="./assets/icons/arrow_drop_down_blue_24dp.svg" alt="">

            <mat-panel-title>
              IVA
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="row">
            <h5 class="col-8 ps-5">
              Porcentaje = {{liquidation?.data?.iva_percentage ? liquidation?.data?.iva_percentage : 0}}%
            </h5>
            <br>
            <h5 class="col-9 ps-5">
              Total iva = (FOB + valor flete internacional + seguro flete internacional + aranceles ) * porcentaje iva
            </h5>

          </div>

        </mat-expansion-panel>
      </mat-accordion>

      <mat-accordion class="mat-accordion-blue">
        <mat-expansion-panel #matExpansionFiles>
          <mat-expansion-panel-header>

            <img [ngStyle]="{'transform': 'scale(2) rotate(' + (matExpansionFiles.expanded ? 180 : 0) + 'deg)'}" src="./assets/icons/arrow_drop_down_blue_24dp.svg" alt="">

            <mat-panel-title>
              Documentos Soporte
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="row my-2">
            <h5 class="col-7 text-center">
              Documento
            </h5>
            <h5 class="col-4 text-center">
              Entidad
            </h5>
          </div>

          <ul *ngFor="let document of listSupportDocuments">
            <li>
              <div class="row">
                <h5 class="col-7">
                  {{document?.document}}
                </h5>
                <h5 class="col-4">
                  {{document?.entity}}
                </h5>
              </div>
            </li>
          </ul>

        </mat-expansion-panel>
      </mat-accordion>

      <mat-accordion class="mat-accordion-blue">
        <mat-expansion-panel #matExpansionFiles>
          <mat-expansion-panel-header>

            <img [ngStyle]="{'transform': 'scale(2) rotate(' + (matExpansionFiles.expanded ? 180 : 0) + 'deg)'}" src="./assets/icons/arrow_drop_down_blue_24dp.svg" alt="">

            <mat-panel-title>
              Regimenes de comercio
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="row my-2">
            <h5 class="col-7 ">
              Concepto
            </h5>
          </div>

          <ul *ngFor="let tradeRegimen of listTradeRegimes">
            <li>
              <div class="row">
                <h5 class="col-7">
                  {{tradeRegimen?.concept}}
                </h5>
              </div>
            </li>
          </ul>

        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </div>
</div>
